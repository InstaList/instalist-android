language: android
env:
    global:
        - ANDROID_ABI=armeabi-v7a
        - ANDROID_TAG=google_apis
android:
    jdk:
      - openjdk8
    components:
      - tools
      # the current build tools version used by this project
      - build-tools-23.0.3
      # the sdk used to compile the project
      - android-23
      - extra-android-support
      - extra-android-m2repository
      - sys-img-armeabi-v7a-google_apis-23
      
    before_install:
      - chmod +x gradlew
      
# Emulator Management: Create, Start and Wait
before_script:
  - echo no | android create avd --force -n test -t "android-23" --abi $ANDROID_ABI --tag $ANDROID_TAG
  - emulator -avd test -no-skin -no-audio -no-window &
  - android-wait-for-emulator

script: 
  - ./gradlew assembleDebug -PpreDexEnable=false -Pcom.android.build.threadPoolSize=1 -Dorg.gradle.parallel=false -Dorg.gradle.jvmargs="-Xms512m -Xmx512m" -Dorg.gradle.daemon=false
  - ./gradlew connectedAndroidTest -PdisablePreDex -Dorg.gradle.daemon=false --console=plain
